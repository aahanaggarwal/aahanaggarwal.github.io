<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pictures - Aahan Aggarwal</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <canvas id="circuit"></canvas>
    <div id="cursor"></div>
    <header>
      <h1 class="typed-text"><span class="glitch">Pictures</span></h1>
      <p class="contact-info"><a href="../">Home</a></p>
    </header>
    <main>
      <div id="gallery"></div>
    </main>

    <script src="../main.js"></script>
    <script>
      function disintegrate(img) {
        img.classList.add("animate-out");
        img.addEventListener(
          "transitionend",
          () => img.classList.remove("animate-out"),
          { once: true }
        );
      }

      function extractYear(name) {
        const match = name.match(/-(\d{4})$/);
        return match ? parseInt(match[1], 10) : NaN;
      }

      async function loadPics() {
        const gallery = document.getElementById("gallery");
        try {
          const res = await fetch("index.json");
          if (!res.ok) throw new Error("index");
          const folders = (await res.json()).sort((a, b) => {
            const yearA = extractYear(a.name);
            const yearB = extractYear(b.name);
            if (isNaN(yearA) && isNaN(yearB)) return 0;
            if (isNaN(yearA)) return 1;
            if (isNaN(yearB)) return -1;
            return yearB - yearA;
          });
          for (const folder of folders) {
            const details = document.createElement("details");
            const summary = document.createElement("summary");
            summary.textContent = folder.name;
            details.appendChild(summary);
            const imagesDiv = document.createElement("div");
            imagesDiv.className = "album-images";
            details.appendChild(imagesDiv);
            gallery.appendChild(details);

            folder.images.forEach((file) => {
              const img = document.createElement("img");
              img.loading = "lazy";
              img.src = `${folder.name}/${file}`;
              img.alt = file;
              img.addEventListener("click", () => disintegrate(img));
              imagesDiv.appendChild(img);
            });
          }
        } catch (err) {
          const p = document.createElement("p");
          p.textContent = "Failed to load pictures.";
          gallery.appendChild(p);
        }
      }
      loadPics();
    </script>
  </body>
</html>
